!function(){"use strict";class FrameworkCore{static#e=null;constructor(){if(FrameworkCore.#e)return FrameworkCore.#e;this.start(),this.setupObjectExtension(),this.setupNumberExtension(),this.setupStringExtension(),this.setupErrorExtension(),this.setupOtherExtension(),Object.freeze(this),FrameworkCore.#e=this,Object.freeze(FrameworkCore)}start(){Object.defineProperty(FrameworkCore,"defineProperty",{value:function(e,t,r,n={}){if(null===e)throw new TypeError("Target cannot be null or undefined.");if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Target must be an object or function.");if("string"!=typeof t&&"symbol"!=typeof t)throw new TypeError("Property key must be a string or symbol.");return Object.defineProperty(e,t,{writable:!1,enumerable:!1,configurable:!1,...n,value:r}),!0},writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(Object,"freezeProp",{value:function(e,t,r){return FrameworkCore.defineProperty(e,t,r)},writable:!1,enumerable:!1,configurable:!1}),Object.freezeProp(Object,"sealProp",function(e,t,r){return FrameworkCore.defineProperty(e,t,r,{writable:!0})}),Object.freezeProp(FrameworkCore,"toString",Object.prototype.toString),Object.freezeProp(Object,"typeOf",function(e){return void 0===e?"undefined":null===e?"null":FrameworkCore.toString.call(e).replace(/^\[object (\S+)\]$/,"$1").toLowerCase()}),Object.freezeProp(Object,"isObject",function(e){return"[object Object]"===FrameworkCore.toString.call(e)}),Object.freezeProp(Object,"hasPrototype",function(e){return null!==e&&"object"==typeof e&&(null!==Object.getPrototypeOf(e)&&"object"==typeof Object.getPrototypeOf(e))}),Object.freezeProp(Object,"pure",function(e=null,t=!1){return Object.isObject(e)?Object.hasPrototype(e)?!0===t?Object.assign(Object.create(null),e):Object.setPrototypeOf(e,null):e:Object.create(null)})}setupObjectExtension(){Object.freezeProp(Object,"getConstructorOf",function(e){if(!Object.hasPrototype(e))throw new TypeError("Object prototype is null.");const t=Object.getPrototypeOf(e);if(!Object.hasOwn(t,"constructor")||"function"!=typeof t.constructor)throw new TypeError("Constructor is invalid.");return t.constructor}),Object.freezeProp(Object,"isClassInstance",function(e,t){if("string"!=typeof t)return!1;if(!Object.hasPrototype(e))return!1;const r=Object.getPrototypeOf(e);return!(!Object.hasOwn(r,"constructor")||!Object.hasOwn(r.constructor,"name")||r.constructor.name!==t)}),Object.freezeProp(Object,"isElement",function(e){return e instanceof HTMLElement})}setupNumberExtension(){Object.freezeProp(Number,"isNumber",function(e){return!("number"!=typeof e||!Number.isFinite(e))})}setupStringExtension(){Object.freezeProp(String,"isNullOrEmpty",function(e){return null==e||"string"!=typeof e||0===e.length}),Object.freezeProp(String,"NON_WHITESPACE_REGEX",/\S/),Object.freezeProp(String,"isNullOrWhiteSpace",function(e){return!!String.isNullOrEmpty(e)||!String.NON_WHITESPACE_REGEX.test(e)}),Object.freezeProp(String,"isNumberOrString",function(e){return!(!Number.isNumber(e)&&String.isNullOrEmpty(e))})}setupErrorExtension(){Object.freezeProp(Error,"throwIfNull",function(e,t=null){if(void 0===e)throw new TypeError(`${t||"Parameter"} is required.`);if(null===e)throw new TypeError(`${t||"Parameter"} cannot be null.`);return!0}),Object.freezeProp(Error,"throwIfNotString",function(e,t=null){if(Error.throwIfNull(e,t),"string"!=typeof e)throw new TypeError(`${t||"Parameter"} must be of string type.`);return!0}),Object.freezeProp(Error,"throwIfEmpty",function(e,t=null){if(Error.throwIfNotString(e,t),0===e.length)throw new TypeError(`${t||"Parameter"} cannot be empty.`);return!0}),Object.freezeProp(Error,"throwIfWhiteSpace",function(e,t=null){if(Error.throwIfNotString(e,t),!String.NON_WHITESPACE_REGEX.test(e))throw new TypeError(`${t||"Parameter"} cannot be empty or whitespace.`);return!0}),Object.freezeProp(Error,"throwIfNotObject",function(e,t=null){if(!Object.isObject(e))throw new TypeError(`${t||"Parameter"} must be of object type.`);return!0}),Object.freezeProp(Error,"throwIfNotFunction",function(e,t=null){if("function"!=typeof e)throw new TypeError(`${t||"Parameter"} must be of function type.`);return!0}),Object.freezeProp(Error,"throwIfNotNumber",function(e,t=null){if("number"!=typeof e||!Number.isFinite(e))throw new TypeError(`${t||"Parameter"} must be of number type.`);return!0}),Object.freezeProp(Error,"throwIfNotArray",function(e,t=null){if(!Array.isArray(e))throw new TypeError(`${t||"Parameter"} must be of array type.`);return!0}),Object.freezeProp(Error,"throwIfNotElement",function(e,t=null){if("undefined"==typeof HTMLElement)throw new Error("DOM API is not available in this environment.");if(!(e instanceof HTMLElement))throw new TypeError(`${t||"Parameter"} must be a HTML element.`);return!0}),Object.freezeProp(Error,"throwIfNotHasOwn",function(e,t,r){if("object"!=typeof e&&"function"!=typeof e)throw new TypeError(`${r||t} must be of object type.`);if(!Object.hasOwn(e,t))throw new TypeError(`${r||t} cannot be null or empty.`);return!0})}setupOtherExtension(){Object.freezeProp(String,"toNotEmptyString",function(e,t=null,r=null){return Number.isNumber(e)&&(e+=""),String.isNumberOrString(r)&&String.isNullOrWhiteSpace(e)?(Number.isNumber(r)&&(r+=""),Error.throwIfWhiteSpace(r,"Default value"),r):(Error.throwIfWhiteSpace(e,t),e.trim())}),Object.freezeProp(URL,"create",function(e,t=null){return e instanceof URL?e:(e=String.toNotEmptyString(e,"URL"),null==t?t=Object.hasOwn(self,"app")&&self.app.configuration.has("base")?self.app.configuration.get("base"):location.origin:Error.throwIfWhiteSpace(t,"baseUrl"),new URL(e,t))}),Object.freezeProp(URL,"loader",async function(e){e=URL.create(e);try{const t=await fetch(e);return t.ok?await t.text():""}catch{return""}}),Object.freezeProp(Element,"create",function(e="div",t=null,r=""){e=String.toNotEmptyString(e,"Tag name","div");const n=document.createElement(e);if(Object.isObject(t)){for(const[e,r]of Object.entries(t))n.setAttribute(e,r||"");t=null}return r&&(n.textContent=r),n}),Object.freezeProp(Element,"createAll",function(e){if(Object.isObject(e)){const t=Element.create(e.tag,e.attrs,e.text);if(Array.isArray(e.children)&&e.children.length>0)for(const r of e.children)Object.isObject(r)&&t.append(Element.createAll(r));return t}return document.createElement("div")})}}class DataBase{#t=null;constructor(e=null){Object.isObject(e)?this.#t=Object.pure(e):this.#t=Object.pure(),Object.freeze(this)}get length(){return Object.keys(this.#t).length}has(e){return Object.hasOwn(this.#t,e)}set(e,t){return e=String.toNotEmptyString(e,"Key"),this.#t[e]=t,this}get(e){return this.has(e)?this.#t[e]:null}keys(){return Object.keys(this.#t)}entries(){return Object.entries(this.#t)}delete(e){return this.has(e)&&delete this.#t[e],this}clear(){for(const e of Object.keys(this.#t))delete this.#t[e];return!0}}class Configuration extends DataBase{constructor(e=null){if(Object.isObject(e))for(const t of Object.keys(e))Object.hasPrototype(e[t])&&Object.setPrototypeOf(e[t],null);super(e)}create(e=null){return new Configuration(e)}}class ServiceManager{constructor(){Object.freezeProp(this,"services",new Map),Object.freezeProp(this,"singletons",new Map),Object.freeze(this)}#r(e){const t=e.dependency.map(e=>this.resolve(e));return new e.constructor(...t)}serviceNames(){return Array.from(this.services.keys())}has(e){return this.services.has(e)}get(e){if(!this.has(e))throw new Error(`The "${e}" service is not registered.`);return this.services.get(e)}delete(e){return this.singletons.delete(e),this.services.delete(e)}resolve(e){const t=this.get(e);return!0===t.singleton?(this.singletons.has(e)||this.singletons.set(e,this.#r(t)),this.singletons.get(e)):this.#r(t)}register(e,t,r={}){if(e=String.toNotEmptyString(e,"Service name"),this.has(e))throw new Error(`The "${e}" service has already been registered.`);if("function"!=typeof t)throw new Error(`The "${e}" service to be registered is invalid.`);Error.throwIfNotObject(r,"Service options");const n={singleton:!1,dependency:[],...r};return Array.isArray(n.dependency)||(n.dependency=[]),this.services.set(e,Object.pure({...n,constructor:t})),this}destroy(){this.singletons.forEach(e=>{"function"==typeof e.destroy&&e.destroy()}),this.services.clear(),this.singletons.clear()}}class PluginManager{constructor(e){Object.freezeProp(PluginManager,"services",e),Object.freezeProp(PluginManager,"plugins",new Map)}get pluginNames(){return Array.from(PluginManager.plugins.keys())}use(e,t={}){if(!Object.isObject(e))throw new TypeError("Invalid plugin.");let r=e.name||t.name;if(r=String.toNotEmptyString(r,"Plugin name"),PluginManager.plugins.has(r))throw new TypeError("The plugin has already been installed.");if(PluginManager.plugins.set(r,Object.pure(e)),"function"==typeof e.install&&!0!==e.installed&&e.install(Application.instance,t),Object.isObject(e.service)){Object.pure(e.service);const t=e.service;r=String.toNotEmptyString(t.name,"Service name");const n=Object.pure({global:!1,singleton:!1,dependency:[],constructor:null,type:"plugin",...t});PluginManager.services.register(r,n.constructor,n),!0===n.global&&(Application.instance[r]=PluginManager.services.resolve(r))}return e.installed=!0,this}unuse(e){if(!PluginManager.plugins.has(e))return this;const t=PluginManager.plugins.get(e);return!0===t.installed&&"function"==typeof t.uninstall&&t.instance.uninstall(Application.instance),Object.isObject(t.service)&&PluginManager.services.delete(t.service.name),PluginManager.plugins.delete(e),t.installed=!1,this}}class ApplicationBuilder{static#e=null;#n=null;#i;#o;#s;#a=[];constructor(){if(ApplicationBuilder.#e)return ApplicationBuilder.#e;new FrameworkCore,this.#c(),ApplicationBuilder.#e=this}#c(){this.#i=new Configuration,this.#o=new ServiceManager,this.#s=new PluginManager(this.#o),this.#n=new Application(this.#i,this.#o,this.#s),this.#i.set("base",location.origin),this.#i.set("environment",window.isSecureContext&&"http:"===location.protocol?"development":"production")}setConfig(e,t){return this.#i.set(e,t),this}addService(e){Error.throwIfNotObject(e,"Registration service configuration"),this.#o.register(e.name,e.service,{name:e.name,singleton:e.singleton,dependency:e.dependency||[],type:"system",global:e.global||!1}),!0===e.global&&Object.freezeProp(this.#n,e.name,this.#o.resolve(e.name))}build(){return this.#n}}class Application{constructor(e,t,r){if(Application.instance)return Application.instance;Object.freezeProp(this,"configuration",e),Object.freezeProp(this,"plugin",r),Object.freezeProp(Application,"services",t),Object.freezeProp(Application,"instance",this),Object.freeze(Application)}static createBuilder(){return new ApplicationBuilder}getConfig(e){return this.configuration.get(e)}setConfig(e,t){return this.configuration.set(e,t)}hasService(e){return Application.services.has(e)}getService(e){return Application.services.resolve(e)}usePlugin(e,t){return this.plugin.use(e,t),this}serviceNames(){return Application.services.serviceNames()}resolve(e){Error.throwIfNotArray(e,"Service names");const t=Object.pure();for(const r of e)Application.services.has(r)&&(t[r]=Application.services.resolve(r));return t}async loader(e){return await URL.loader(e)}run(){Object.hasOwn(this,"initial")&&this.initial.execute(),delete Object.getPrototypeOf(this).run}}class InitialService{constructor(){if(InitialService.instance)return InitialService.instance;Object.sealProp(this,"executed",!1),this.handlers=Object.pure({open:null,loaded:null}),Object.freezeProp(InitialService,"instance",this),Object.freeze(InitialService)}set open(e){Error.throwIfNotFunction(e,"Value"),this.handlers.open=e}set loaded(e){Error.throwIfNotFunction(e,"Value"),this.handlers.loaded=e}execute(){if(!this.executed)try{"function"==typeof this.handlers.open&&this.handlers.open(),self.addEventListener("DOMContentLoaded",()=>{try{"function"==typeof this.handlers.loaded&&this.handlers.loaded(),this.executed=!0,delete this.handlers,Object.freeze(this)}catch(e){return!1}},{once:!0}),this.executed=!0}catch(e){return!1}return!0}}class Component{constructor(e,t){this.name=e,this.props=t.observedAttributes||null,this.component=t,Object.sealProp(t,"routing",!1),Object.sealProp(t,"position",Object.pure({left:0,top:0}))}createInstance(){return new this.component}getComponentClass(){return this.component}}class ComponentStyles{constructor(){this.created=!1,this.styles=[],this.styleSheet=null}get has(){return this.styles.length>0}set style(e){this.created||(Error.throwIfNotString(e,"Component style"),this.styles.push(ComponentStyles.compress(e)))}async getStyleSheet(){if(null===this.styleSheet){const e=new CSSStyleSheet;if(this.styles.length>0)try{for(let e=0;e<this.styles.length;e++){const t=this.styles[e];(t.endsWith(".css")||!t.includes("{")&&!t.includes("}"))&&(this.styles[e]=ComponentStyles.compress(await URL.loader(URL.create(t,ComponentService.instance.base))))}e.replaceSync([...ComponentStyles.base,...this.styles].join(""))}catch{throw new TypeError("Component style loading failed.")}else e.replaceSync(ComponentStyles.base.join(""));this.styleSheet=[e],this.created=!0}return this.styleSheet}static compress(e){return e.replace(/\n\s*/g,"").replace(/\s*{\s*/g,"{").replace(/\s*}\s*/g,"}").replace(/\s*:\s*/g,":").replace(/\s*;\s*/g,";").replace(/;\s*}/g,"}").replace(/\/\*[\s\S]*?\*\//g,"").trim()}}class ComponentTemplate{constructor(){this.innerHTML="<slot></slot>",this.url=null,this.created=!1,this.fragment=null}set html(e){if(!this.created){if(Error.throwIfNotString(e,"Component template"),e=ComponentTemplate.compress(e),String.isNullOrWhiteSpace(e)||e.includes("<")||e.includes(">"))this.innerHTML=e;else try{this.url=URL.create(e,ComponentService.instance.base)}catch{this.innerHTML=e}this.created=!0}}async getFragment(){if(null===this.fragment){if(null!==this.url)try{const e=await URL.loader(this.url);this.innerHTML=ComponentTemplate.compress(e)}catch{throw new TypeError("Component template loading failed.")}if(String.isNullOrWhiteSpace(this.innerHTML))this.fragment=document.createDocumentFragment();else{const e=document.createRange().createContextualFragment(this.innerHTML);e.querySelectorAll("script").forEach(e=>e.remove()),e.querySelectorAll("[onerror]").forEach(e=>e.removeAttribute("onerror")),this.fragment=e}}return this.created=!0,this.fragment.cloneNode(!0)}static compress(e){return e.replace(/<!--[\s\S]*?-->/g,"").trim()}}class ComponentBuilder extends HTMLElement{#l="core-element";#h="open";#u=[];#p=Object.pure();#f=Object.pure();#d=null;#b=null;#g=null;#m=null;#y=null;#v=!1;#O=!1;#w=null;constructor(){if(super(),this.#m=Object.getConstructorOf(this),Object.hasOwn(this.#m,"instance"))return this.#m.instance;this.#l=this.#m.tag,Object.hasOwn(this.#m,"template")||(this.#m.template=new ComponentTemplate),Object.hasOwn(this.#m,"styles")||(this.#m.styles=new ComponentStyles),"function"==typeof this.create&&this.create(),this.#w=this.#S(),!0!==this.#m.routing&&this.#w.then(e=>{"function"==typeof this.onCreated&&"function"==typeof this.onBeforeMount?Promise.resolve(this.onCreated()).then(()=>Promise.resolve(this.onBeforeMount())).then(()=>this.#j(e)):"function"==typeof this.onCreated?Promise.resolve(this.onCreated()).then(this.#j(e)):"function"==typeof this.onBeforeMount?Promise.resolve(this.onBeforeMount()).then(()=>this.#j(e)):this.#j(e)})}get root(){return this.#d}get shadow(){return this.#b}get services(){return this.#p}get config(){return this.#g}get props(){return this.#m.observedAttributes||null}get name(){return this.#l}get state(){return this.#f}set state(e){this.#f=e}template(e){return!0===this.#m.template.created||(this.#m.template.html=e),this}styles(e){return!0===this.#m.styles.created||(this.#m.styles.style=e),this}mode(e="open"){if(!["open","closed"].includes(e))throw new TypeError('Shadow DOM mode must be either "open" or "closed"');return this.#h=e,this}inject(e){return Error.throwIfNotArray(e,"Component service inject"),this.#u=e,this}configuration(e){return this.#g=Application.instance.configuration.create(e),this}connectedCallback(){if(this.#O&&"function"==typeof this.onConnected)return this.onConnected()}async attributeChangedCallback(e,t,r){if(this.#v&&"function"==typeof this.onAttributeChanged)return this.#O||await this.#w,this.onAttributeChanged(e,r,t)}adoptedCallback(){if("function"==typeof this.onAdopted)return this.onAdopted()}disconnectedCallback(){if("function"==typeof this.onDisconnected)return this.onDisconnected()}async routeCallback(e){if(!0===this.#O){if(null!==this.#y){const t=this.#y.get(e);if(t)return t.clear(),t}return null}{const t=await this.#w;return"function"==typeof this.onCreated&&await Promise.resolve(this.onCreated()),"function"==typeof this.onBeforeMount&&await Promise.resolve(this.onBeforeMount()),this.#j(t),this.#y.get(e)||null}}async beforeRouteCallback(e){if(!0===this.#O)return"function"!=typeof this.onBeforeRoute||await Promise.resolve(this.onBeforeRoute(e));{const t=await this.#w;let r=!0;return"function"==typeof this.onCreated&&await Promise.resolve(this.onCreated()),"function"==typeof this.onBeforeRoute&&(r=await Promise.resolve(this.onBeforeRoute(e))),!0===r&&("function"==typeof this.onBeforeMount&&await Promise.resolve(this.onBeforeMount()),this.#j(t)),r}}querySelector(e){return this.#d.querySelector(e)}querySelectorAll(e){return this.#d.querySelectorAll(e)}selector(e){return this.#d.querySelector(e)}service(e){return Object.hasOwn(this.#p,e)?this.#p[e]:null}async#S(){if(this.#b=this.attachShadow({mode:this.#h}),this.#m.styles.created=!0,this.#v=!0,this.#m.styles.has){const e=await this.#m.styles.getStyleSheet();this.#b.adoptedStyleSheets=e}return this.#d=await this.#m.template.getFragment(),this.#b.append(document.createElement("div")),this.#b.firstElementChild.classList.add("root"),this.#u.length>0&&(this.#p=Application.instance.resolve(this.#u)),this.#d}#j(e){const t=e.querySelectorAll("router-view");if(t.length>0){this.#y=new Map;for(let e=0;e<t.length;e++){const r=t[e].hasAttribute("name")?t[e].getAttribute("name"):"default";this.#y.set(r,t[e])}}this.#O=!0,this.#w=null,this.#d=this.#b.firstElementChild,Application.instance.router.bind(e),this.#d.replaceChildren(e),!0!==this.#m.routing&&"function"==typeof this.onConnected&&this.onConnected(),this.#m.routing=!1,"function"==typeof this.onMounted&&this.onMounted()}static check(e){return(e=String.toNotEmptyString(e,"Component tag name")).includes("-")||(e=`core-${e}`),e}}class ComponentService{#E=new Map;constructor(){if(ComponentService.instance)return ComponentService.instance;Object.freezeProp(this,"builder",ComponentBuilder),Object.sealProp(this,"base",location.origin),Object.sealProp(ComponentStyles,"base",[]),this.styles("@layer reset,token,theme,base,layout,component,view,utilitie,override;@layer reset{:host{box-sizing:border-box;contain:content}header,nav,main,footer,article,section,aside{box-sizing:border-box}h1,h2,h3,h4,h5,h6{box-sizing:border-box}ul,ol,li,dl,dt,dd{box-sizing:border-box}div,p,span,a,i,img,svg,button{box-sizing:border-box}dialog,details,summary{box-sizing:border-box}router-view{box-sizing: border-box;display:block;overflow:auto;scrollbar-width:thin}h1,h2,h3,h4,h5,h6,p,ol,ul{margin:0}dl,dd,menu,figure,blockquote{margin:0}img,video{font-size:inherit;vertical-align:top}ul,ol,menu{padding:0}button{outline:none;font-size:inherit;font-family:inherit;white-space:nowrap;border:none;appearance:none;cursor:pointer}button:focus{outline:none}a[to],a[data-href],a[data-to]{cursor:pointer}dialog{overscroll-behavior-y:contain}a,img{-webkit-user-drag:none}a,summary,button,svg{-webkit-user-select:none;user-select:none}a,li,button,[onclick]{-webkit-tap-highlight-color:transparent}}"),Object.freezeProp(Object.getPrototypeOf(Application.instance),"useComponent",function(e){ComponentService.instance.use(e)}),Object.freezeProp(ComponentService,"instance",this),Object.freeze(ComponentService)}async load(e,t){e=URL.create(e);try{const r=(await import(e.href)).default;return this.register(r,t),r}catch{throw new Error("Component loading failed.")}}has(e){return e=ComponentBuilder.check(e),this.#E.has(e)}get(e){if(e=ComponentBuilder.check(e),!this.#E.has(e))throw new Error("Component not registered, please register first");return this.#E.get(e).createInstance()}getClass(e){if(e=ComponentBuilder.check(e),!this.#E.has(e))throw new Error("Component not registered, please register first");return this.#E.get(e).getComponentClass()}register(e,t){if(!ComponentBuilder.isPrototypeOf(e)&&!HTMLElement.isPrototypeOf(e))throw new Error("Invalid component.");if(String.isNullOrWhiteSpace(t)){if(String.isNullOrWhiteSpace(e.tag))throw new Error("Missing component tag name.");t=ComponentBuilder.check(e.tag)}else t=ComponentBuilder.check(t);if(!this.#E.has(t))try{customElements.define(t,e);const r=new Component(t,e);return this.#E.set(t,r),r}catch(r){throw new Error(`Failed to register component "${t}": ${r.message}.`)}return this.#E.get(t)}registerAll(e){if(Object.isObject(e))Object.entries(e).forEach(([e,t])=>{this.register(t,e)});else if(Array.isArray(e))for(const t of e)this.register(t);return this}use(e){return ComponentBuilder.isPrototypeOf(e)||HTMLElement.isPrototypeOf(e)?this.register(e):this.registerAll(e),this}clear(){return this.#E.clear(),this}async styles(e){"string"==typeof e&&(e.endsWith(".css")&&(e=await URL.loader(URL.create(e,this.base))),ComponentStyles.base.push(ComponentStyles.compress(e)))}validName(e){return ComponentBuilder.check(e)}}class CacheEntry{#P=null;#C=null;#T=null;#z=0;#R=null;#v=null;#k=null;constructor(e=null,t=null,r=null,n=null){Error.throwIfWhiteSpace(e,"key");const i=Date.now();if(this.#v=i,this.#k=i,this.#C=e,this.#T=t,this.#R=n,this.#P=Object.pure({sliding:0,absolute:0}),Object.isObject(r))for(const o of Object.keys(this.#P))Object.hasOwn(r,o)&&"number"==typeof r[o]&&(this.#P[o]=r[o]);this.#P.sliding>0&&(this.#z=i+1e3*this.#P.sliding),this.#P.absolute>0&&(this.#z=i+1e3*this.#P.absolute),Object.seal(this)}get key(){return this.#C}get value(){const e=Date.now();return this.#P.sliding>0&&(this.#z=e+1e3*this.#P.sliding),this.#k=e,this.#T}get handler(){const e=this.#R;return this.#R=null,e}get expired(){return this.#z>0&&Date.now()>this.#z&&(this.#T=null,!0)}}class RouteRule{static keys=["path","name","redirect","component","cache","meta","params"];constructor(e){if(Object.isObject(e)){for(const t of RouteRule.keys)Object.hasOwn(e,t)&&Object.sealProp(this,t,e[t]);if(Object.hasOwn(this,"cache")||Object.freezeProp(this,"cache",!1),Object.hasOwn(this,"params")&&Object.isObject(this.params)){Object.pure(this.params);for(const e of Object.values(this.params))Object.pure(e)}}}}class Route{static keys=["from","to","name","params","meta","view","link"];constructor(e,t,r=!1){if(Error.throwIfNull(t,"Routing"),Object.freezeProp(this,"mode",e),Object.freezeProp(this,"replace",r),"string"==typeof t)Object.freezeProp(this,"to",t),this.parse(t);else if(Object.isObject(t)){Error.throwIfNotHasOwn(t,"to","To");for(const e of Route.keys)Object.hasOwn(t,e)&&Object.freezeProp(this,e,t[e]);this.parse(t.to)}Object.hasOwn(this,"from")||("hash"===e?Object.freezeProp(this,"from",location.hash.replace("#","")):"history"===e&&Object.freezeProp(this,"from",location.pathname)),Object.hasOwn(this,"view")||Object.freezeProp(this,"view","default")}parse(e){const t=new URL(e,location.origin);if(Object.sealProp(this,"path",t.pathname),t.searchParams.size>0)if(Object.hasOwn(this,"params"))for(const[r,n]of t.searchParams.entries())this.params[r]=n;else Object.freezeProp(this,"params",Object.pure(Object.fromEntries(t.searchParams)))}}class RouteSheet{constructor(e){if(Object.freezeProp(this,"paths",new Map),Object.freezeProp(this,"names",new Map),Array.isArray(e))for(const t of e)this.set(t)}pathname(e){if(!(e instanceof Route))throw new TypeError("Route is invalid.");let t=null;if(Object.hasOwn(e,"path")?t=e.path:Object.hasOwn(e,"name")&&this.names.has(e.name)&&(t=this.names.get(e.name).path,e.path=t),this.paths.has(t)){const r=this.paths.get(t);Object.hasOwn(r,"redirect")&&(t=r.redirect,e.path=t)}return t}parse(e){Error.throwIfNotString(e,"Path name");const t=e.replace("/","").split("/");let r="";for(let n=0;n<t.length;n++)t[n]=`${r}/${t[n]}`,r=t[n];return r=null,t}get(e){const t=this.parse(e),r=[];for(const n of t)this.paths.has(n)&&r.push(this.paths.get(n));return r}set(e,t=""){if(Object.hasOwn(e,"redirect"))return this.paths.set(e.path,new RouteRule(e)),!0;if(Error.throwIfNotHasOwn(e,"path","Route"),Error.throwIfNotHasOwn(e,"component","Route"),"string"!=typeof e.component&&"function"!=typeof e.component)throw new TypeError("Component invalid.");if("function"==typeof e.component&&Object.getPrototypeOf(e.component)!==ComponentBuilder)throw new TypeError('The component is invalid and is not a "webcore" component.');const r=`${t}${String.toNotEmptyString(e.path)}`;e.path=r;const n=new RouteRule(e);if(this.paths.set(r,n),Object.hasOwn(e,"name")){if(e.name=String.toNotEmptyString(e.name),this.names.has(e.name))throw new TypeError("Duplicate route name.");this.names.set(e.name,n)}if(Object.getPrototypeOf(e.component)===ComponentBuilder&&ComponentService.instance.register(e.component),Object.hasOwn(e,"children")&&Array.isArray(e.children))for(const i of e.children)this.set(i,r)}}class RouterView extends HTMLElement{constructor(){super()}render(e){this.replaceChildren(e)}clear(){this.replaceChildren()}}customElements.define("router-view",RouterView);class Router{constructor(e,t,r){if(Object.freezeProp(this,"mode",Router.check(e)),Object.sealProp(this,"current",null),!(t instanceof RouterView))throw new TypeError('Invalid "router-view" element.');Object.freezeProp(this,"view",t),this.useRoute(r)}to(e){return Error.throwIfNotObject(e),!0===e.replace?this.replace(e):this.push(e),!0}push(e){return this.#x(new Route(this.mode,e,!1)),!0}replace(e){return this.#x(new Route(this.mode,e,!0)),!0}async#x(e){if("function"==typeof RouterService.beforeEach){const t=await RouterService.beforeEach(e);if(!1===t)return!1;if(Object.isObject(t)&&!String.isNullOrWhiteSpace(t.to))return this.to(t)}let t=this.routes.get(e.from);for(const s of t)if(Router.cache.has(s.path)){const e=Router.cache.get(s.path);e.parentElement?(s.component.position.left=e.parentElement.scrollLeft,s.component.position.top=e.parentElement.scrollTop):(s.component.position.left=0,s.component.position.top=0)}const r=this.routes.pathname(e);if(null===r)return!1;if(t=this.routes.get(r),0===t.length)return!1;const n=[];for(const s of t){"string"==typeof s.component&&(s.component=await ComponentService.instance.load(s.component));const e=s.component;if(e.routing=!0,!0===s.cache||"number"==typeof s.cache&&s.cache>0){Router.cache.has(s.path)||Router.cache.set(s.path,new e,{absolute:!0===s.cache?0:s.cache});const t=Router.cache.get(s.path);t.position=e.position,n.push(t)}else{const t=new e;t.position=Object.pure({left:0,top:0}),n.push(t)}}const i=n[0],o=n.pop();if("function"==typeof o.beforeRouteCallback){const t=await o.beforeRouteCallback(e);if(!1===t)return!1;if(Object.isObject(t)&&!String.isNullOrWhiteSpace(t.to))return this.to(t);this.#O(r,e,n,i,o)}else this.#O(r,e,n,i,o);return!0}async#O(e,t,r,n,i){if(r.length>0)try{const e=await Promise.all(r.map(e=>e.routeCallback(t.view))),n=e.length-1;if(n>0)for(let t=0;t<n;t++)e[t].render(r[t+1]),this.scrollTo(e[t],r[t+1].position);e[n].render(i),this.scrollTo(e[n],i.position)}catch{return!1}this.view.contains(n)||this.view.render(n),this.scrollTo(this.view,n.position),"function"==typeof i.onRouted&&i.onRouted(t),this.#N(e,t)}#N(e,t){return e=Object.isObject(t.params)&&Object.keys(t.params).length>0?"history"===this.mode?`${RouterService.instance.base}${e}?${new URLSearchParams(t.params).toString()}`:`${RouterService.instance.base}/#${e}?${new URLSearchParams(t.params).toString()}`:"history"===this.mode?`${RouterService.instance.base}${e}`:`${RouterService.instance.base}/#${e}`,this.current&&this.current.link instanceof HTMLAnchorElement&&this.current.link.classList.remove("active"),t.link instanceof HTMLAnchorElement&&t.link.classList.add("active"),this.current=t,t.replace?top.history.replaceState(t,"",e):top.history.pushState(t,"",e),!0}scrollTo(e,t){const r="smooth"===getComputedStyle(e).scrollBehavior;r&&(e.style.scrollBehavior="auto"),e.scrollLeft!==t.left&&(e.scrollLeft=t.left),e.scrollTop!==t.top&&(e.scrollTop=t.top),r&&(e.style.scrollBehavior="smooth")}start(e){if("history"===this.mode)location.pathname.endsWith("/index.html")?this.replace("/"):this.replace(location.pathname.replace(RouterService.instance.base,""));else if(location.hash){const e=location.hash.indexOf("?");e>-1?this.to({to:location.hash.replace("#",""),replace:!0,params:Object.pure(Object.fromEntries(new URLSearchParams(location.hash.slice(e+1))))}):this.replace(location.hash.replace("#",""))}else this.replace("/");return!0}useRoute(e){if(Error.throwIfNotArray(e,"Routes"),Object.hasOwn(this,"routes"))for(const t of e)this.routes.set(t);else Object.freezeProp(this,"routes",new RouteSheet(e));return this}static check(e){if(e=String.toNotEmptyString(e,"Router mode"),["hash","history"].includes(e))return e;throw new TypeError('Router mode must be "hash" or "history".')}}class RouterService{constructor(e){if(RouterService.instance)return RouterService.instance;e&&Object.freezeProp(Router,"cache",e),Object.sealProp(RouterService,"beforeEach",null),Object.sealProp(RouterService,"afterEach",null),Object.freezeProp(Object.getPrototypeOf(Application.instance),"useRouter",function(e){RouterService.instance.use(e)}),Object.sealProp(this,"base",""),Object.sealProp(RouterService,"executed",!1),Object.freezeProp(RouterService,"handlers",Object.pure());const t=RouterService.handlers;t.top=e=>{e.preventDefault(),top.location.replace(e.currentTarget.dataset.href)},t.parent=e=>{e.preventDefault(),parent.location.replace(e.currentTarget.dataset.href)},t.blank=e=>{e.preventDefault(),self.open(e.currentTarget.dataset.href,"_blank")},t.assign=e=>{e.preventDefault(),location.assign(e.currentTarget.dataset.href)},t.replace=e=>{e.preventDefault(),location.replace(e.currentTarget.dataset.href)},Object.freezeProp(RouterService,"instance",this)}init(){if(RouterService.executed)return!0;RouterService.handlers.frames=Object.pure();const e=top.frames.length;for(let t=0;t<e;t++){const e=Object.pure();e.frame=top.frames[t],e.assign=t=>{t.preventDefault(),e.frame.location.assign(t.currentTarget.dataset.href)},e.replace=t=>{t.preventDefault(),e.frame.location.replace(t.currentTarget.dataset.href)};const r=top.frames[t].name||"view";RouterService.handlers.frames[r]=e}RouterService.executed=!0}anchor(e){return(e instanceof HTMLElement||e instanceof DocumentFragment)&&(0===e.childElementCount&&null!==e.parentElement&&(e=e.parentElement),e.querySelectorAll("a[data-href]").forEach(e=>{const t=!!e.hasAttribute("data-target")&&e.dataset.target.trim(),r=!!e.hasAttribute("data-iframe")&&e.dataset.iframe.trim();if(t){if("top"===t)return e.onclick=RouterService.handlers.top,!0;if("parent"===t)return e.onclick=RouterService.handlers.parent,!0;if("blank"===t)return e.onclick=RouterService.handlers.blank,!0}return r&&Object.hasOwn(RouterService.handlers.frames,r)?t&&"self"===t?(e.onclick=RouterService.handlers.frames[r].replace,!0):(e.onclick=RouterService.handlers.frames[r].assign,!0):t&&"self"===t?(e.onclick=RouterService.handlers.replace,!0):(e.onclick=RouterService.handlers.assign,!0)}),!0)}use(e){if(Error.throwIfNotObject(e,"Router"),Object.freezeProp(this,"mode",Router.check(e.mode)),!String.isNullOrWhiteSpace(e.base))try{const t=new URL(e.base.trim(),location.origin);this.base=t.pathname.replace(/\/+$/,"")}catch{throw new URIError("Router base path invalid.")}const t=new CSSStyleSheet;t.replaceSync("@layer reset,token,theme,base,layout,component,view,utilitie,override;@layer reset{router-view{box-sizing: border-box;display:block;overflow:auto;scrollbar-width:thin}}"),document.adoptedStyleSheets=[...document.adoptedStyleSheets,t],"hash"===this.mode?top.onhashchange=function(e){RouterService.router.to(Object.pure({from:new URL(e.oldURL).hash.replace("#",""),to:new URL(e.newURL).hash.replace("#",""),replace:!0}))}:"history"===this.mode&&(top.onpopstate=function(e){RouterService.instance.replace(location.pathname.replace(RouterService.instance.base,""))}),top.addEventListener("DOMContentLoaded",()=>{this.init(),document.documentElement.classList.contains("app")&&this.anchor(document.body);const t=document.querySelector("router-view");t&&(Object.freezeProp(RouterService,"router",new Router(this.mode,t,e.routes)),Object.freezeProp(RouterService,"invoke",function(e){if(!(e instanceof Event))return!1;const t=e.currentTarget,r=Object.pure({to:t.getAttribute("to"),params:Object.pure(),replace:!!t.hasAttribute("replace"),link:t});t.hasAttribute("name")&&(r.view=t.getAttribute("name"));const n=t.getAttributeNames();let i=null;for(const o of n)i=o.split("-"),"data"===i[0]&&"params"===i[1]&&(r.params[i[2]]=t.getAttribute(o));return RouterService.router.to(r),i=null,!0}),RouterService.handlers.router=e=>{RouterService.invoke(e)},Object.freezeProp(this,"push",function(e){RouterService.router.push(e)}),Object.freezeProp(this,"replace",function(e){RouterService.router.replace(e)}),RouterService.router.start()),Object.freeze(RouterService)},{once:!0})}bind(e){return(e instanceof HTMLElement||e instanceof DocumentFragment)&&(0===e.childElementCount&&null!==e.parentElement&&(e=e.parentElement),e.querySelectorAll("a[to]").forEach(e=>{e.onclick=RouterService.handlers.router}),this.anchor(e),!0)}beforeEach(e){Error.throwIfNotFunction(e),RouterService.beforeEach=e}}class GlobalData extends DataBase{constructor(e=null){super(e)}}class GlobalService{static#e=null;constructor(){if(GlobalService.#e)return GlobalService.#e;Object.freezeProp(this,"system",new GlobalData),Object.freezeProp(this,"vars",new GlobalData),Object.freezeProp(this,"constants",new GlobalData),this.start(),GlobalService.#e=this,Object.freeze(GlobalService)}start(){this.system.set("framework",Object.pure({name:"webcore",version:"0.0.1",author:"huachen"}))}}class OrientationChange{static#e=null;constructor(){if(OrientationChange.#e)return OrientationChange.#e;Object.freezeProp(OrientationChange,"tasks",[]),Object.sealProp(OrientationChange,"running",!1),Object.freeze(this),OrientationChange.#e=this}get running(){return OrientationChange.running}get length(){return OrientationChange.tasks.length}add(e){return this.running||"function"!=typeof e||(this.remove(e),OrientationChange.tasks.push(e)),this}has(e){return"function"==typeof e&&-1!==OrientationChange.tasks.indexOf(e)}async execute(){if(this.running)return!1;OrientationChange.running=!0;for(const t of OrientationChange.tasks)try{await Promise.resolve(t())}catch(e){}return OrientationChange.running=!1,!0}remove(e){if(!this.running&&"function"==typeof e){const t=OrientationChange.tasks.indexOf(e);if(-1!==t)return OrientationChange.tasks.splice(t,1),!0}return!1}removeAt(e){return!this.running&&"number"==typeof e&&(!(e<0||e>this.length)&&(OrientationChange.tasks.splice(e,1),!0))}clear(){return OrientationChange.tasks=[],this}}class Orientation{static#e=null;constructor(){if(Orientation.#e)return Orientation.#e;Object.freezeProp(this,"change",new OrientationChange),Object.freezeProp(Orientation,"media",top.matchMedia("(orientation: landscape)")),Orientation.media.onchange=()=>{this.change.execute()};const e=()=>{Orientation.media.matches?document.documentElement.classList.remove("portrait"):document.documentElement.classList.add("portrait")},t=screen.orientation;(document.documentElement.classList.contains("dync")||t.type.startsWith("p")&&(90==t.angle||270==t.angle)||t.type.startsWith("l")&&(0==t.angle||180==t.angle))&&this.change.add(e),e(),Object.freeze(this),Orientation.#e=this}get landscape(){return Orientation.media.matches}get portrait(){return!Orientation.media.matches}get matches(){return Orientation.media.matches?"landscape":"portrait"}destroy(){Orientation.media.onchange=null,this.change.clear(),Orientation.#e=null}}class LayoutService{static#e=null;constructor(){if(LayoutService.#e)return LayoutService.#e;Object.freezeProp(this,"orientation",new Orientation),Object.sealProp(LayoutService,"executed",!1),this.start(),LayoutService.executed=!0,LayoutService.#e=this,Object.freeze(LayoutService)}get landscape(){return this.orientation.landscape}get portrait(){return this.orientation.portrait}get fontSize(){return parseFloat(getComputedStyle(document.documentElement).getPropertyValue("font-size"))}start(){if(LayoutService.executed)return!1;const e=document.documentElement;return this.setupFontScaling(e),this.setupUserExperience(e),!0}setupFontScaling(e){if(e.classList.contains("dync"))return!1;e.style.fontSize="11.55pt";const t=screen.orientation,r={base:28.57,initial:parseFloat(getComputedStyle(e).getPropertyValue("font-size"))||15.4};e.removeAttribute("style");const n=()=>{0==t.angle||180==t.angle?e.classList.add("portrait"):e.classList.remove("portrait")},i=()=>{0==t.angle||180==t.angle?(e.style.fontSize=r.portrait,e.classList.add("portrait")):(e.style.fontSize=r.landscape,e.classList.remove("portrait"))},o=screen.width/r.initial<r.base||screen.height/r.initial<r.base;return!t.type.startsWith("p")||0!=t.angle&&180!=t.angle?!t.type.startsWith("l")||90!=t.angle&&270!=t.angle||(o?top.innerWidth>screen.width?(r.portrait=top.innerWidth/r.base+"px",r.landscape=top.innerWidth/screen.width*(screen.height/r.base)+"px",e.style.fontSize=r.landscape,t.onchange=i):(r.portrait=screen.height/r.base+"px",e.style.fontSize=r.portrait,t.onchange=n):t.onchange=n):(e.classList.add("portrait"),o?(r.portrait=top.innerWidth/r.base+"px",e.style.fontSize=r.portrait,top.innerWidth>screen.width?(r.landscape=top.innerWidth/screen.height*(screen.width/r.base)+"px",t.onchange=i):t.onchange=n):t.onchange=n),!0}setupUserExperience(e){e.classList.contains("ban")&&(e.oncontextmenu=e=>(e.preventDefault(),e.stopPropagation(),!1));const t=function(){};return document.addEventListener("touchstart",t,{passive:!0}),window.onbeforeunload=()=>{document.removeEventListener("touchstart",t)},!0}}class EventBuilder{#A=null;#L=Object.pure();#P=Object.pure();constructor(e){Error.throwIfNotElement(e,"Event target"),this.#A=e,Object.freeze(this)}get element(){return this.#A}get handlers(){return this.#L}get options(){return this.#P}on(e,t,r=null){return Error.throwIfWhiteSpace(e,"Event name"),Error.throwIfNotFunction(t,"Event handler"),e=e.trim(),this.#L[e]=t,r&&(this.#P[e]=r),this}bind(){return Error.throwIfNull(EventBuilder.EventService,"Event service instance"),EventBuilder.EventService.register(this),this}once(e,t,r=null){return Object.isObject(r)||(r=Object.pure()),r.once=!0,this.on(e,t,r)}click(e,t){return this.on("click",e,t)}pointerdown(e,t){return this.on("pointerdown",e,t)}pointerup(e,t){return this.on("pointerup",e,t)}submit(e,t){return this.on("submit",e,t)}reset(e,t){return this.on("reset",e,t)}invalid(e,t){return this.on("invalid",e,t)}resize(e,t){return this.on("resize",e,t)}scroll(e,t){return this.on("scroll",e,t)}focus(e,t){return this.on("focus",e,t)}blur(e,t){return this.on("blur",e,t)}change(e,t){return this.on("change",e,t)}input(e,t){return this.on("input",e,t)}keydown(e,t){return this.on("keydown",e,t)}toggle(e,t){return this.on("toggle",e,t)}show(e,t){return this.on("show",e,t)}open(e,t){return this.on("open",e,t)}close(e,t){return this.on("close",e,t)}error(e,t){return this.on("error",e,t)}message(e,t){return this.on("message",e,t)}dblclick(e,t){return this.on("dblclick",e,t)}contextmenu(e,t){return this.on("contextmenu",e,t)}hover(e,t,r){return this.on("mouseenter",e,r),this.on("mouseleave",t,r),this}}class EventProvider{constructor(){if(EventProvider.instance)return EventProvider.instance;Object.freezeProp(EventProvider,"events",new Map),Object.freeze(this),Object.freezeProp(EventProvider,"instance",this)}expose(e,t={}){return e=String.toNotEmptyString(e,"Provider"),!!Object.isObject(t)&&(EventProvider.events.delete(e),EventProvider.events.set(e,Object.pure(t)),!0)}has(e,t=null){return e=String.toNotEmptyString(e,"Provider"),!!EventProvider.events.has(e)&&(!!String.isNullOrWhiteSpace(t)||Object.hasOwn(EventProvider.events.get(e),t.trim()))}use(e,t=null){if(e=String.toNotEmptyString(e,"Provider"),this.has(e)){const r=EventProvider.events.get(e);if(Object.isObject(r)){if(String.isNullOrWhiteSpace(t))return r;if(t=t.trim(),Object.hasOwn(r,t))return r[t]}}return null}delete(e){return e=String.toNotEmptyString(e,"Provider"),EventProvider.events.delete(e),this}clear(){return EventProvider.events.clear(),!0}}class EventService{constructor(){if(EventService.instance)return EventService.instance;Object.sealProp(EventService,"handlers",new WeakMap),Object.freezeProp(EventProvider,"provider",new EventProvider),Object.freezeProp(EventService,"invoke",function(e){const t=e.type;let r=null;if(this.instance.has(e.currentTarget,t)?r=EventService.handlers.get(e.currentTarget)[t]:this.instance.has(e.target,t)&&(r=EventService.handlers.get(e.target)[t]),"function"==typeof r)try{return r(e)}catch(n){return!1}return!1}),Object.freezeProp(EventService,"handler",e=>EventService.invoke(e)),Object.freezeProp(EventBuilder,"EventService",this),Object.freeze(EventBuilder),Object.freeze(this),Object.freezeProp(EventService,"instance",this)}expose(e,t){return EventProvider.provider.expose(e,t)}use(e,t){return EventProvider.provider.use(e,t)}delete(e){return EventProvider.provider.delete(e)}select(e){if(Object.isElement(e))return new EventBuilder(e);if(Object.isClassInstance(e,"ReactiveElement"))return new EventBuilder(e.element);throw new ReferenceError("Invalid element.")}register(e){try{if(e instanceof EventBuilder){EventService.handlers.set(e.element,e.handlers);for(const t of Object.keys(e.handlers))Object.hasOwn(e.options,t)?e.element.addEventListener(t,EventService.handler,e.options[t]):e.element.addEventListener(t,EventService.handler)}}catch(t){return!1}}has(e,t){return!String.isNullOrWhiteSpace(t)&&("string"==typeof e?EventProvider.provider.has(e,t):e instanceof HTMLElement&&(!!EventService.handlers.has(e)&&Object.hasOwn(EventService.handlers.get(e),t.trim())))}emit(e,t,...r){let n=null;n="string"==typeof e?EventProvider.provider.use(e,t):EventService.handlers.get(e)[t.trim()];try{if("function"==typeof n)return n(...r)}catch(i){throw i}return!1}remove(e,t=null){if(this.has(e)){let r=EventService.handlers.get(e);if("string"==typeof t){if(!Object.hasOwn(r,t))return this;r[t]=null,delete r[t],e.removeEventListener(t,EventService.handler),0===Object.keys(r).length&&EventService.handlers.delete(e)}else{for(const t of Object.keys(r))r[t]=null,e.removeEventListener(t,EventService.handler);r=null,EventService.handlers.delete(e)}}return this}destroy(){return EventService.handlers=new WeakMap,EventProvider.provider.clear(),!0}target(e,t,r=10){if(!(e instanceof Event))return null;if(!e.target||!e.currentTarget)return null;let n=e.target;const i=e.currentTarget;if("string"!=typeof t)return n;if(!(t=t.trim().toUpperCase()))return n;if(n===i)return i.nodeName===t?n:null;if("string"==typeof t){let e=0;for(;e<r&&n!=i;){if(n.nodeName===t)return n;if(!n.parentElement)return null;n=n.parentElement,e++}}return null}debounce(e,t=300){let r=null;return function(...n){const i=this;r&&clearTimeout(r),r=setTimeout(()=>{e.apply(i,n),r=null},t)}}throttle(e,t=300){let r=0;return function(...n){const i=Date.now();i-r>=t&&(e.apply(this,n),r=i)}}}class HttpClient{constructor(e=null){if(this.url="",this.baseUrl=location.origin,Object.freezeProp(this,"headers",Object.pure()),Object.freezeProp(this,"payload",Object.pure()),Object.freezeProp(this,"expand",Object.pure()),Object.sealProp(this,"cache",0),Object.sealProp(this,"timeout",0),Object.sealProp(this,"abort",!1),Object.sealProp(this,"parse","json"),Object.sealProp(this,"encoding","utf-8"),Object.sealProp(this,"timeoutId",null),Object.sealProp(this,"abortController",null),Object.sealProp(this,"ontimeout",e=>{}),Object.sealProp(this,"onabort",e=>{}),!HttpClient.isKeyValuePair(e))return this;for(const[t,r]of Object.entries(HttpClient.config))if(Object.hasOwn(e,t)){if(typeof e[t]!==r.type)throw new TypeError(`The ${t} must be of ${r.type} type.`);if(Object.hasOwn(r,"valid")&&!r.valid.includes(e[t]))throw new TypeError(`The ${t} is invalid.`);this[t]=e[t]}if(Object.hasOwn(e,"url")){if("string"!=typeof e.url&&!(e.url instanceof URL))throw new URIError("URL invalid.");const t="string"==typeof e.url?new URL(e.url,location.origin):e.url;this.url=t.href,this.baseUrl=t.origin}"number"==typeof e.cache&&(Number.isNumber(e.cache)&&(this.cache=e.cache),delete e.cache);for(const t of["headers","payload"])if(Object.hasOwn(e,t)){if(!HttpClient.isKeyValuePair(e[t]))throw new TypeError(`The ${t} must be of object type.`);for(const r of Object.keys(e[t]))this[t][r]=e[t][r]}for(const[t,r]of Object.entries(HttpClient.expand))if(Object.hasOwn(e,t)){if(typeof e[t]!==r.type)throw new TypeError(`The ${t} must be of ${r.type} type.`);if(!r.valid.includes(e[t]))throw new TypeError(`The ${t} is invalid.`);this.expand[t]=e[t]}for(const t of["Content-Type","Accept"])if(Object.hasOwn(this.headers,t))for(const e of HttpClient.format)if(this.headers[t].includes(e)){this.headers[t]=`${this.headers[t]}; charset=${this.encoding}`;break}}get authorization(){return this.headers&&Object.hasOwn(this.headers,"Authorization")?this.headers.Authorization:""}set authorization(e){"string"==typeof e&&(this.headers.Authorization=e)}get contentType(){return this.headers&&Object.hasOwn(this.headers,"Content-Type")?this.headers["Content-Type"]:""}set contentType(e){if("string"==typeof e)for(const t of HttpClient.format)if(e.includes(t)){this.headers["Content-Type"]=`${e}; charset=${this.encoding}`;break}}async get(e=null,t=0){return await this.send(this.getUrl(e),"GET",null,t)}async post(e,t=0){return await this.send(this.getUrl(),"POST",e,t)}async put(e,t=0){return await this.send(this.getUrl(),"PUT",e,t)}async delete(e,t=0){return await this.send(this.getUrl(),"DELETE",e,t)}getUrl(e=null){const t=this.url instanceof URL?this.url:new URL(this.url,this.baseUrl);if(e=e||this.payload,HttpClient.isKeyValuePair(e))for(const r of Object.keys(e))t.searchParams.set(r,e[r]);return t}async send(e=null,t="GET",r=null,n=0){if("string"==typeof e)e=URL.create(e,this.baseUrl);else if(!(e instanceof URL))throw new URIError("URL invalid.");if(this.cache>0&&HttpClient.cache.has(e.href))return Promise.resolve(HttpClient.cache.get(e.href));const i=Object.pure();if("string"!=typeof t)throw new TypeError("The method is invalid.");if(i.method=t.trim().toUpperCase(),!HttpClient.method.includes(i.method))throw new TypeError("The method is invalid.");Object.keys(this.headers).length>0&&(i.headers=new Headers(this.headers)),Object.assign(i,this.expand),null!=r&&(HttpClient.isKeyValuePair(r)?(r=JSON.stringify(r),Object.hasOwn(i,"headers")&&i.headers.set("Content-Type",`application/json; charset=${this.encoding}`)):Object.hasOwn(i,"headers")&&i.headers.delete("Content-Type"),i.body=r),this.abortController=new AbortController,i.signal=this.abortController.signal,"function"==typeof this.onrequest&&this.onrequest(i),(n=Number(n)||Number(this.timeout)||0)>0&&(this.timeoutId=setTimeout(()=>{this.abortController.abort(),"function"==typeof this.ontimeout&&this.ontimeout()},n));try{const t=await fetch(e,i);if(this.timeoutId&&clearTimeout(this.timeoutId),!t.ok){if("function"==typeof this.validateStatus)return this.validateStatus(t);throw new Error(`HTTP ${t.status}: ${t.statusText}`)}const r=await HttpClient.parse(this.parse,t);return this.cache>0&&HttpClient.cache.set(e.href,r,{absolute:this.cache}),"function"==typeof this.onresponse?this.onresponse(r):r}catch(o){if(this.timeoutId&&clearTimeout(this.timeoutId),"AbortError"===o.name&&"function"==typeof this.onabort)return this.onabort();throw o}finally{this.timeoutId&&(clearTimeout(this.timeoutId),this.timeoutId=null),this.abortController=null}}cancel(){return!!this.abortController&&(this.abortController.abort(),!0)}}class HttpService{static#e=null;constructor(e){if(HttpService.#e)return HttpService.#e;Object.freezeProp(HttpClient,"cache",e),HttpClient.method=["GET","POST","PUT","DELETE","HEAD","PATCH","OPTIONS"],HttpClient.config={baseUrl:{type:"string"},parse:{type:"string",valid:["text","json","blob","formData","arrayBuffer"]},encoding:{type:"string"},onrequest:{type:"function"},onresponse:{type:"function"},timeout:{type:"number"},ontimeout:{type:"function"},abort:{type:"boolean"},onabort:{type:"function"},validateStatus:{type:"function"}},HttpClient.expand={mode:{type:"string",valid:["cors","same-origin","no-cors"]},credentials:{type:"string",valid:["omit","same-origin","include"]},cache:{type:"string",valid:["default","no-cache","no-store","reload","force-cache"]},redirect:{type:"string",valid:["follow","error","manual"]}},HttpClient.format=["text","json","css","script","htm","xml"],HttpClient.isKeyValuePair=function(e){return["object","map"].includes(Object.typeOf(e))},HttpClient.parse=async function(e,t){switch(e){case"json":return await t.json();case"text":default:return await t.text();case"blob":return await t.blob();case"formData":return await t.formData();case"arrayBuffer":return await t.arrayBuffer()}},Object.freeze(HttpClient),Object.freezeProp(this,"default",new HttpClient),Object.freeze(this),HttpService.#e=this,Object.freeze(HttpService)}create(e=null){return new HttpClient(e)}async get(e,t,r){return this.default.url=e,this.default.get(t,r)}async post(e,t,r){return this.default.url=e,this.default.post(t,r)}async put(e,t,r){return this.default.url=e,this.default.put(t,r)}async delete(e,t,r){return this.default.url=e,this.default.delete(t,r)}}class StateService extends DataBase{static#e=null;constructor(){if(super(),StateService.#e)return StateService.#e;Object.freeze(this),StateService.#e=this}}class ReactiveElement{#A=null;#T="";#I=null;constructor(e,t=null){e instanceof HTMLElement?this.#A=e:this.#A=document.createElement("div"),"string"==typeof t?(this.#A.textContent=t,this.#T=t):this.#T=this.#A.textContent,Object.freeze(this)}get element(){return this.#A}get value(){return this.#T}set value(e){"function"==typeof this.#I&&this.#T!==e&&this.#I(e,this.#T,this.#A),this.#T=e,this.#A.textContent=e}set onchange(e){Error.throwIfNotFunction(e,"Change callback"),this.#I=e}mount(e){if("string"==typeof e){const t=document.querySelector(e);t&&t.append(this.#A)}else e instanceof HTMLElement&&e.append(this.#A);return this}unmount(){return this.#A.remove(),this}}class ReactiveStore{#M=null;constructor(e=null){const t=Object.pure();t.value=e,this.#M=new Proxy(t,{get:(e,t)=>e.value,set:(e,t,r)=>{let n=e.value;return e.value=r,"function"==typeof this.onchange&&this.onchange(r,n),n=null,!0}})}get value(){return this.#M.value}set value(e){this.#M.value=e}}class ReactiveService{static#e=null;constructor(){if(ReactiveService.#e)return ReactiveService.#e;Object.freeze(ReactiveElement),Object.freeze(ReactiveStore),ReactiveService.#e=this}element(e="div",t){if(e instanceof HTMLElement)return new ReactiveElement(e,t);try{"string"!=typeof e&&(e="div");const r=document.createElement(e);return new ReactiveElement(r,t)}catch{return new ReactiveElement(document.createElement("div"),t)}}store(e){return new ReactiveStore(e)}}class StorageStore{constructor(e){Object.freezeProp(this,"data",e)}get length(){return this.data.length}has(e){return e=String.toNotEmptyString(e,"Key"),null!==this.data.getItem(e)}set(e,t){return e=String.toNotEmptyString(e,"Key"),null==t?(this.data.removeItem(e),this):(this.data.setItem(e,JSON.stringify(t)),this)}get(e,t=null){e=String.toNotEmptyString(e,"Key");const r=this.data.getItem(e);try{return null===r?t:JSON.parse(r)}catch(n){return r}}keys(){return Object.keys(this.data)}entries(){const e=[];for(let r=0;r<this.data.length;r++){const n=this.data.key(r),i=this.data.getItem(n);try{e.push([n,JSON.parse(i)])}catch(t){e.push([n,i])}}return e}delete(e){return e=String.toNotEmptyString(e,"Key"),this.data.removeItem(e),this}clear(){return this.data.clear(),this}}class StorageService{static#e=null;constructor(){if(StorageService.#e)return StorageService.#e;Object.freezeProp(Map.prototype,"toObject",function(){const e=Object.pure();for(const[t,r]of this.entries())String.isNumberOrString(t)&&(e[t]=r);return e}),Object.freezeProp(Map.prototype,"toJSON",function(){return this.toObject()}),Object.freezeProp(Set.prototype,"toArray",function(){return Array.from(this)}),Object.freezeProp(Set.prototype,"toJSON",function(){return this.toArray()}),Object.freezeProp(this,"local",new StorageStore(localStorage)),Object.freezeProp(this,"session",new StorageStore(sessionStorage)),Object.freezeProp(this,"database",null),StorageService.#e=this,Object.freeze(StorageService)}}class UtilityService{static#e=null;constructor(){if(UtilityService.#e)return UtilityService.#e;UtilityService.#e=this}getRandomInteger(e,t){Error.throwIfNull(e,"Max value"),Error.throwIfNotNumber(e,"Max value");let r=Math.floor(Math.random()*e);if("number"==typeof t)for(;r==t;)r=Math.floor(Math.random()*e);return r}}class ViewportService{constructor(){if(ViewportService.instance)return ViewportService.instance;Object.freezeProp(ViewportService,"instance",this)}}class Encoding{constructor(){Object.freezeProp(this,"encoder",new TextEncoder),Object.freezeProp(this,"decoder",new TextDecoder("utf-8"))}stringToBytes(e){return Error.throwIfNotString(e),this.encoder.encode(e)}bytesToString(e){if(!(e instanceof Uint8Array))throw new TypeError("Invalid Uint8Array type.");return this.decoder.decode(e)}bytesToHex(e){if(!(e instanceof Uint8Array))throw new TypeError("Invalid Uint8Array type.");return Array.from(e,e=>e.toString(16).padStart(2,"0")).join("")}hexToBytes(e){if(Error.throwIfNotString(e,"Hex string"),e.length%2!=0)throw new TypeError("Hex string must have even length");const t=new Uint8Array(e.length/2);for(let r=0;r<e.length;r+=2)t[r/2]=parseInt(e.substr(r,2),16);return t}hexToBase64(e){return this.bytesToBase64(this.hexToBytes(e))}base64ToHex(e){return this.bytesToHex(this.base64ToBytes(e))}arrayBufferToHex(e){if(!(e instanceof ArrayBuffer))throw new TypeError("Invalid ArrayBuffer type.");return this.bytesToHex(new Uint8Array(e))}bytesToBase64(e){if(!(e instanceof Uint8Array))throw new TypeError("Invalid Uint8Array type.");let t="";if(e.byteLength<=65536){for(let r=0;r<e.byteLength;r++)t+=String.fromCharCode(e[r]);return window.btoa(t)}{const r=32768;for(let n=0;n<e.byteLength;n+=r){const i=e.subarray(n,Math.min(n+r,e.byteLength));t+=String.fromCharCode.apply(null,i)}return window.btoa(t)}}arrayBufferToBase64(e){if(!(e instanceof ArrayBuffer))throw new TypeError("Invalid ArrayBuffer type.");return this.bytesToBase64(new Uint8Array(e))}base64ToBytes(e){Error.throwIfNotString(e,"Base64");try{const t=window.atob(e),r=new Uint8Array(t.length);for(let e=0;e<t.length;e++)r[e]=t.charCodeAt(e);return r}catch{throw new TypeError("Base64 decoding error.")}}base64ToArrayBuffer(e){return this.base64ToBytes(e).buffer}stringToBase64(e){return this.bytesToBase64(this.stringToBytes(e))}base64ToString(e){return this.bytesToString(this.base64ToBytes(e))}stringToUrlBase64(e){return this.stringToBase64(e).replace(/\+/g,"-").replace(/\//g,"_").replace(/=+$/,"")}urlBase64ToString(e){for(Error.throwIfNotString(e,"Base64"),e=e.replace(/-/g,"+").replace(/_/g,"/");e.length%4;)e+="=";return this.base64ToString(e)}}class TextService{static#e=null;constructor(){if(TextService.#e)return TextService.#e;Object.freezeProp(this,"encoding",new Encoding),Object.sealProp(this,"sanitize",null),TextService.#e=this}}const e=Application.createBuilder(),t=[{name:"initial",service:InitialService,singleton:!0,global:!0},{name:"component",service:ComponentService,singleton:!0,global:!0},{name:"cache",service:class CacheService{#t=new Map;constructor(){Object.freeze(this)}async expire(e){const t=e.handler;return this.#t.delete(e.key),null!==t?Promise.resolve(t()):Promise.resolve(null)}get count(){return this.#t.size}has(e){return Error.throwIfWhiteSpace(e,"key"),!!this.#t.has(e)&&null!==this.get(e)}set(e,t,r=null,n=null){if(null!=t){const i=new CacheEntry(e,t,r,n);this.#t.set(e,i)}return this}get(e){if(Error.throwIfWhiteSpace(e,"key"),this.#t.has(e)){const t=this.#t.get(e);return t.expired?(this.expire(t),null):t.value}return null}delete(e){return this.get(e),this.#t.delete(e),this}keys(){return this.#t.keys()}clear(){return this.#t.clear(),this}},singleton:!1,global:!0},{name:"router",service:RouterService,singleton:!0,global:!0,dependency:["cache"]},{name:"layout",service:LayoutService,singleton:!0,global:!0},{name:"global",service:GlobalService,singleton:!0,global:!0},{name:"event",service:EventService,singleton:!0,global:!0},{name:"http",service:HttpService,singleton:!0,global:!0,dependency:["cache"]},{name:"state",service:StateService,singleton:!0,global:!0},{name:"reactive",service:ReactiveService,singleton:!0,global:!0},{name:"storage",service:StorageService,singleton:!0,global:!0},{name:"utility",service:UtilityService,singleton:!0,global:!0},{name:"viewport",service:ViewportService,singleton:!0,global:!0},{name:"text",service:TextService,singleton:!0,global:!0}];for(const n of t)e.addService(n);const r=e.build();Object.freezeProp(self,"webcore",r)}();