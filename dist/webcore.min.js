!function(){"use strict";class FrameworkCore{static#e=null;constructor(){if(FrameworkCore.#e)return FrameworkCore.#e;this.start(),this.setupNumberExtension(),this.setupStringExtension(),this.setupErrorExtension(),this.setupOtherExtension(),Object.freeze(this),FrameworkCore.#e=this,Object.freeze(FrameworkCore)}start(){Object.defineProperty(FrameworkCore,"defineProperty",{value:function(e,t,r,n={}){if(null===e)throw new TypeError("Target cannot be null or undefined.");if("object"!=typeof e&&"function"!=typeof e)throw new TypeError("Target must be an object or function.");if("string"!=typeof t&&"symbol"!=typeof t)throw new TypeError("Property key must be a string or symbol.");return Object.defineProperty(e,t,{writable:!1,enumerable:!1,configurable:!1,...n,value:r}),!0},writable:!1,enumerable:!1,configurable:!1}),Object.defineProperty(Object,"freezeProp",{value:function(e,t,r){return FrameworkCore.defineProperty(e,t,r)},writable:!1,enumerable:!1,configurable:!1}),Object.freezeProp(Object,"sealProp",function(e,t,r){return FrameworkCore.defineProperty(e,t,r,{writable:!0})}),Object.freezeProp(FrameworkCore,"toString",Object.prototype.toString),Object.freezeProp(Object,"typeOf",function(e){return void 0===e?"undefined":null===e?"null":FrameworkCore.toString.call(e).replace(/^\[object (\S+)\]$/,"$1").toLowerCase()}),Object.freezeProp(Object,"isObject",function(e){return"[object Object]"===FrameworkCore.toString.call(e)}),Object.freezeProp(Object,"hasPrototype",function(e){return null!==e&&"object"==typeof e&&(null!==Object.getPrototypeOf(e)&&"object"==typeof Object.getPrototypeOf(e))}),Object.freezeProp(Object,"pure",function(e=null,t=!1){return Object.isObject(e)?Object.hasPrototype(e)?!0===t?Object.assign(Object.create(null),e):Object.setPrototypeOf(e,null):e:Object.create(null)})}setupNumberExtension(){Object.freezeProp(Number,"isNumber",function(e){return!("number"!=typeof e||!Number.isFinite(e))})}setupStringExtension(){Object.freezeProp(String,"isNullOrEmpty",function(e){return null==e||"string"!=typeof e||0===e.length}),Object.freezeProp(String,"NON_WHITESPACE_REGEX",/\S/),Object.freezeProp(String,"isNullOrWhiteSpace",function(e){return!!String.isNullOrEmpty(e)||!String.NON_WHITESPACE_REGEX.test(e)}),Object.freezeProp(String,"isNumberOrString",function(e){return!(!Number.isNumber(e)&&String.isNullOrEmpty(e))})}setupErrorExtension(){Object.freezeProp(Error,"throwIfNull",function(e,t=null){if(void 0===e)throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} is required.`);if(null===e)throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} cannot be null.`);return!0}),Object.freezeProp(Error,"throwIfNotString",function(e,t=null){if(Error.throwIfNull(e,t),"string"!=typeof e)throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} must be of string type.`);return!0}),Object.freezeProp(Error,"throwIfWhiteSpace",function(e,t=null){if(Error.throwIfNotString(e,t),!String.NON_WHITESPACE_REGEX.test(e))throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} cannot be empty or whitespace.`);return!0}),Object.freezeProp(Error,"throwIfNotObject",function(e,t=null){if(!Object.isObject(e))throw new TypeError(`${String.isNullOrWhiteSpace(t)?"Parameter":t} must be of object type.`);return!0})}setupOtherExtension(){Object.freezeProp(String,"toNotEmptyString",function(e,t=null,r=null){return Number.isNumber(e)&&(e+=""),String.isNumberOrString(r)&&String.isNullOrWhiteSpace(e)?(Number.isNumber(r)&&(r+=""),Error.throwIfWhiteSpace(r,"Default value"),r):(Error.throwIfWhiteSpace(e,t),e.trim())})}}class ServiceManager{static#e=null;constructor(){if(ServiceManager.#e)return ServiceManager.#e;Object.freezeProp(ServiceManager,"services",new Map),Object.freezeProp(ServiceManager,"singletons",new Map),Object.freeze(this),ServiceManager.#e=this,Object.freeze(ServiceManager)}#t(e){const t=e.dependency.map(e=>this.get(e));return new e.constructor(...t)}serviceNames(){return Array.from(ServiceManager.services.keys())}has(e){return ServiceManager.services.has(e)}get(e){if(!this.has(e))throw new Error(`The "${e}" service is not registered.`);const t=ServiceManager.services.get(e);return t.singleton?(ServiceManager.singletons.has(e)||ServiceManager.singletons.set(e,this.#t(t)),ServiceManager.singletons.get(e)):this.#t(t)}register(e,t,r={}){if(e=String.toNotEmptyString(e,"Service name"),this.has(e))throw new Error(`The "${e}" service has already been registered.`);if("function"!=typeof t)throw new Error(`The "${e}" service to be registered is invalid.`);Error.throwIfNotObject(r,"Service options");const n={singleton:!1,dependency:[],...r};return ServiceManager.services.set(e,{constructor:t,...n}),this}addSingleton(e,t,r=[]){return this.register(e,t,{singleton:!0,dependency:r})}addTransient(e,t,r=[]){return this.register(e,t,{singleton:!1,dependency:r})}destroy(){ServiceManager.singletons.forEach(e=>{"function"==typeof e.destroy&&e.destroy()}),ServiceManager.services.clear(),ServiceManager.singletons.clear()}}class DataBase{#r=null;constructor(e=null){Object.isObject(e)?this.#r=Object.pure(e):this.#r=Object.pure(),Object.freeze(this)}get length(){return Object.keys(this.#r).length}has(e){return Object.hasOwn(this.#r,e)}set(e,t){return e=String.toNotEmptyString(e,"Key"),this.#r[e]=t,this}get(e){return this.has(e)?this.#r[e]:null}keys(){return Object.keys(this.#r)}entries(){return Object.entries(this.#r)}delete(e){return this.has(e)&&delete this.#r[e],this}clear(){for(const e of Object.keys(this.#r))delete this.#r[e];return!0}}class Configuration extends DataBase{constructor(e=null){if(Object.isObject(e))for(const t of Object.keys(e))Object.hasPrototype(e[t])&&Object.setPrototypeOf(e[t],null);super(e)}create(e=null){return new Configuration(e)}}class RouterService{static#e=null;constructor(){if(RouterService.#e)return RouterService.#e;top.history.replaceState(!0,null,location.origin+location.pathname),Object.freezeProp(RouterService,"handlers",Object.pure());const e=RouterService.handlers;e.top=e=>{e.preventDefault(),top.location.replace(e.currentTarget.dataset.href)},e.parent=e=>{e.preventDefault(),parent.location.replace(e.currentTarget.dataset.href)},e.blank=e=>{e.preventDefault(),self.open(e.currentTarget.dataset.href,"_blank")},e.assign=e=>{e.preventDefault(),location.assign(e.currentTarget.dataset.href)},e.replace=e=>{e.preventDefault(),location.replace(e.currentTarget.dataset.href)},document.documentElement.classList.contains("webcore")&&top.addEventListener("DOMContentLoaded",()=>{this.init(),this.anchor(document.body)},{once:!0}),Object.freeze(this),RouterService.#e=this,Object.freeze(RouterService)}init(){RouterService.handlers.frames=Object.pure();const e=top.frames.length;for(let t=0;t<e;t++){const e=Object.pure();e.frame=top.frames[t],e.assign=t=>{t.preventDefault(),e.frame.location.assign(t.currentTarget.dataset.href)},e.replace=t=>{t.preventDefault(),e.frame.location.replace(t.currentTarget.dataset.href)};const r=top.frames[t].name||"view";RouterService.handlers.frames[r]=e}}anchor(e){return e instanceof HTMLElement&&(0==e.childElementCount&&(e=e.parentElement),e.querySelectorAll("a[data-href]").forEach(e=>{const t=!!e.hasAttribute("data-target")&&e.dataset.target.trim(),r=!!e.hasAttribute("data-iframe")&&e.dataset.iframe.trim();if(t){if("top"===t)return e.onclick=RouterService.handlers.top,!0;if("parent"===t)return e.onclick=RouterService.handlers.parent,!0;if("blank"===t)return e.onclick=RouterService.handlers.blank,!0}return r&&Object.hasOwn(RouterService.handlers.frames,r)?t&&"self"===t?(e.onclick=RouterService.handlers.frames[r].replace,!0):(e.onclick=RouterService.handlers.frames[r].assign,!0):t&&"self"===t?(e.onclick=RouterService.handlers.replace,!0):(e.onclick=RouterService.handlers.assign,!0)}),!0)}}class GlobalData extends DataBase{constructor(e=null){super(e)}}class GlobalService{static#e=null;constructor(){if(GlobalService.#e)return GlobalService.#e;Object.freezeProp(GlobalService,"system",new GlobalData),Object.freezeProp(GlobalService,"vars",new GlobalData),Object.freezeProp(GlobalService,"state",new GlobalData),Object.freeze(this),GlobalService.#e=this,Object.freeze(GlobalService)}get vars(){return GlobalService.vars}get system(){return GlobalService.system}get state(){return GlobalService.state}}class OrientationChange{static#e=null;constructor(){if(OrientationChange.#e)return OrientationChange.#e;Object.freezeProp(OrientationChange,"tasks",[]),Object.sealProp(OrientationChange,"running",!1),Object.freeze(this),OrientationChange.#e=this}get running(){return OrientationChange.running}get length(){return OrientationChange.tasks.length}add(e){return this.running||"function"!=typeof e||(this.remove(e),OrientationChange.tasks.push(e)),this}has(e){return"function"==typeof e&&-1!==OrientationChange.tasks.indexOf(e)}async execute(){if(this.running)return!1;OrientationChange.running=!0;for(const t of OrientationChange.tasks)try{await Promise.resolve(t())}catch(e){}return OrientationChange.running=!1,!0}remove(e){if(!this.running&&"function"==typeof e){const t=OrientationChange.tasks.indexOf(e);if(-1!==t)return OrientationChange.tasks.splice(t,1),!0}return!1}removeAt(e){return!this.running&&"number"==typeof e&&(!(e<0||e>this.length)&&(OrientationChange.tasks.splice(e,1),!0))}clear(){return OrientationChange.tasks=[],this}}class Orientation{static#e=null;constructor(){if(Orientation.#e)return Orientation.#e;Object.freezeProp(this,"change",new OrientationChange),Object.freezeProp(Orientation,"media",top.matchMedia("(orientation: landscape)")),Orientation.media.onchange=()=>{this.change.execute()};const e=()=>{Orientation.media.matches?document.documentElement.classList.remove("portrait"):document.documentElement.classList.add("portrait")},t=screen.orientation;(document.documentElement.classList.contains("dync")||t.type.startsWith("p")&&(90==t.angle||270==t.angle)||t.type.startsWith("l")&&(0==t.angle||180==t.angle))&&this.change.add(e),e(),Object.freeze(this),Orientation.#e=this}get landscape(){return Orientation.media.matches}get portrait(){return!Orientation.media.matches}get matches(){return Orientation.media.matches?"landscape":"portrait"}destroy(){Orientation.media.onchange=null,this.change.clear(),Orientation.#e=null}}class LayoutService{static#e=null;constructor(){if(LayoutService.#e)return LayoutService.#e;Object.freezeProp(this,"orientation",new Orientation),Object.sealProp(LayoutService,"executed",!1),this.start(),LayoutService.executed=!0,LayoutService.#e=this,Object.freeze(LayoutService)}get landscape(){return this.orientation.landscape}get portrait(){return this.orientation.portrait}get fontSize(){return parseFloat(getComputedStyle(document.documentElement).getPropertyValue("font-size"))}start(){if(LayoutService.executed)return!1;const e=document.documentElement;return this.setupFontScaling(e),this.setupUserExperience(e),!0}setupFontScaling(e){if(e.classList.contains("dync"))return!1;e.style.fontSize="11.55pt";const t=screen.orientation,r={base:28.57,initial:parseFloat(getComputedStyle(e).getPropertyValue("font-size"))||15.4};e.removeAttribute("style");const n=()=>{0==t.angle||180==t.angle?e.classList.add("portrait"):e.classList.remove("portrait")},i=()=>{0==t.angle||180==t.angle?(e.style.fontSize=r.portrait,e.classList.add("portrait")):(e.style.fontSize=r.landscape,e.classList.remove("portrait"))},a=screen.width/r.initial<r.base||screen.height/r.initial<r.base;return!t.type.startsWith("p")||0!=t.angle&&180!=t.angle?!t.type.startsWith("l")||90!=t.angle&&270!=t.angle||(a?top.innerWidth>screen.width?(r.portrait=top.innerWidth/r.base+"px",r.landscape=top.innerWidth/screen.width*(screen.height/r.base)+"px",e.style.fontSize=r.landscape,t.onchange=i):(r.portrait=screen.height/r.base+"px",e.style.fontSize=r.portrait,t.onchange=n):t.onchange=n):(e.classList.add("portrait"),a?(r.portrait=top.innerWidth/r.base+"px",e.style.fontSize=r.portrait,top.innerWidth>screen.width?(r.landscape=top.innerWidth/screen.height*(screen.width/r.base)+"px",t.onchange=i):t.onchange=n):t.onchange=n),!0}setupUserExperience(e){e.classList.contains("ban")&&(e.oncontextmenu=e=>(e.preventDefault(),e.stopPropagation(),!1));const t=function(){};return document.addEventListener("touchstart",t,{passive:!0}),window.onbeforeunload=()=>{document.removeEventListener("touchstart",t)},!0}}class ApplicationBuilder{static#e=null;#n=null;#i;#a;#o;#s=[];constructor(){if(ApplicationBuilder.#e)return ApplicationBuilder.#e;new FrameworkCore,this.#c(),ApplicationBuilder.#e=this}#c(){this.#a=new ServiceManager,this.#i=new Configuration,this.#i.set("base",location.origin),this.#i.set("environment",window.isSecureContext&&"http:"===location.protocol?"development":"production")}setConfig(e,t){return this.#i.set(e,t),this}addSingleton(e,t,r){return this.#a.addSingleton(e,t,r),this.#s.push(e),this}addTransient(e,t,r){return this.#a.addTransient(e,t,r),this.#s.push(e),this}build(){const e=new Application(this.#i,this.#a,this.#o),t=[{name:"router",service:RouterService},{name:"layout",service:LayoutService},{name:"global",service:GlobalService}];for(const r of t)this.#a.addSingleton(r.name,r.service,r.deps),Object.freezeProp(e,r.name,this.#a.get(r.name));return Object.freeze(e),e}}class Application{static#e=null;constructor(e,t,r){if(Application.#e)return Application.#e;Object.freezeProp(this,"configuration",e),Object.freezeProp(Application,"services",t),Object.freeze(Application),Application.#e=this}static createBuilder(){return new ApplicationBuilder}getConfig(e){return this.configuration.get(e)}setConfig(e,t){return this.configuration.set(e,t)}run(){Object.hasOwn(this,"initial")&&this.initial.execute(),delete Object.getPrototypeOf(this).run}}const e=Application.createBuilder().build();e.run(),Object.freezeProp(self,"webcore",e)}();